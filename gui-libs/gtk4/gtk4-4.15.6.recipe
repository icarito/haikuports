SUMMARY="A multi-platform toolkit for creating graphical user interfaces"
DESCRIPTION="GTK is a multi-platform toolkit for creating graphical user \
interfaces. Offering a complete set of widgets, GTK is suitable for projects \
ranging from small one-off projects to complete application suites."
HOMEPAGE="https://www.gtk.org"
COPYRIGHT="GNOME Desktop"
LICENSE="GNU GPL v2"
REVISION="1"
SOURCE_URI="https://gitlab.gnome.org/GNOME/gtk/-/archive/$portVersion/gtk-$portVersion.tar.bz2"
CHECKSUM_SHA256="d4782b0c6edaab44c1937530221c1d7a44de652956ad49ca0c571cd4d244703e"
PATCHES="gtk4-$portVersion.patchset"
ADDITIONAL_FILES="compile-schemas.sh"

SOURCE_DIR="gtk-$portVersion"

ARCHITECTURES="all !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

libVersion=1.1506.0

commandSuffix=$secondaryArchSuffix
commandBinDir=$binDir
if [ "$targetArchitecture" = x86_gcc2 ]; then
        commandSuffix=
        commandBinDir=$prefix/bin
fi


POST_INSTALL_SCRIPTS="
        $relativePostInstallDir/compile-schemas.sh
        "

PROVIDES="
	gtk4$secondaryArchSuffix = $portVersion
	lib:libgtk_4$secondaryArchSuffix = $libVersion
	cmd:gtk4_builder_tool
	cmd:gtk4_demo
	cmd:gtk4_demo_application
	cmd:gtk4_encode_symbolic_svg
	cmd:gtk4_icon_browser
	cmd:gtk4_image_tool
	cmd:gtk4_launch
	cmd:gtk4_node_editor
	cmd:gtk4_path_tool
	cmd:gtk4_print_editor
	cmd:gtk4_query_settings
	cmd:gtk4_rendernode_tool
	cmd:gtk4_update_icon_cache
	cmd:gtk4_widget_factory
	"

PROVIDES_devel="
        gtk4${secondaryArchSuffix}_devel
        devel:libgtk_4$secondaryArchSuffix = $libVersion
        "

REQUIRES="
        haiku$secondaryArchSuffix
        adwaita_icon_theme
        haiku_svg_icon_theme
        iso_codes
        gsettings_desktop_schemas$secondaryArchSuffix
        shared_mime_info$secondaryArchSuffix
        graphene$secondaryArchSuffix
        lib:libatk_1.0$secondaryArchSuffix
        lib:libcairo$secondaryArchSuffix
        lib:libcairo_gobject$secondaryArchSuffix
        lib:libepoxy$secondaryArchSuffix
        lib:libfontconfig$secondaryArchSuffix
        lib:libfreetype$secondaryArchSuffix
        lib:libfribidi$secondaryArchSuffix
        lib:libgdk_pixbuf_2.0$secondaryArchSuffix
        lib:libgirepository_1.0$secondaryArchSuffix
        lib:libglib_2.0$secondaryArchSuffix
        lib:libGL$secondaryArchSuffix
        lib:libgraphene_1.0$secondaryArchSuffix
        lib:libharfbuzz$secondaryArchSuffix
        lib:libharfbuzz_gobject$secondaryArchSuffix
        lib:libiconv$secondaryArchSuffix
        lib:libintl$secondaryArchSuffix
        lib:libpango_1.0$secondaryArchSuffix
        lib:libpangocairo_1.0$secondaryArchSuffix
        lib:libpangoft2_1.0$secondaryArchSuffix
        lib:librsvg_2$secondaryArchSuffix
        lib:liborc_0.4$secondaryArchSuffix
        lib:libwayland_client$secondaryArchSuffix
        lib:libwayland_server$secondaryArchSuffix
        lib:libxkbcommon$secondaryArchSuffix
        lib:libz$secondaryArchSuffix
        lib:wayland_server_inproc$secondaryArchSuffix
	lib:libjpeg$secondaryArchSuffix
	lib:libtiff$secondaryArchSuffix
	lib:libpng16$secondaryArchSuffix
        "


REQUIRES_devel="
        gtk4$secondaryArchSuffix == $portVersion base
        devel:libatk_1.0$secondaryArchSuffix
        devel:libcairo$secondaryArchSuffix
        devel:libgdk_pixbuf_2.0$secondaryArchSuffix
        devel:libgirepository_1.0$secondaryArchSuffix
        devel:libGL$secondaryArchSuffix
        devel:libglib_2.0$secondaryArchSuffix
        devel:libepoxy$secondaryArchSuffix
        devel:libpango_1.0$secondaryArchSuffix
        devel:libwayland_client$secondaryArchSuffix
        devel:libwayland_server$secondaryArchSuffix
        devel:libxkbcommon$secondaryArchSuffix
        devel:libz$secondaryArchSuffix
        "

BUILD_REQUIRES="
        haiku${secondaryArchSuffix}_devel
        harfbuzz${secondaryArchSuffix}_glib
        iso_codes
        wayland_protocols
        devel:libatk_1.0$secondaryArchSuffix
        devel:libcairo$secondaryArchSuffix
        devel:libGL$secondaryArchSuffix
        devel:libgdk_pixbuf_2.0$secondaryArchSuffix
        devel:libgirepository_1.0$secondaryArchSuffix
        devel:libglib_2.0$secondaryArchSuffix
        devel:libgraphene_1.0$secondaryArchSuffix
	devel:libharfbuzz$secondaryArchSuffix
        devel:libharfbuzz_gobject$secondaryArchSuffix
        devel:libepoxy$secondaryArchSuffix
        devel:libpango_1.0$secondaryArchSuffix
        devel:liborc_0.4$secondaryArchSuffix
        devel:libwayland_client$secondaryArchSuffix
        devel:libwayland_server$secondaryArchSuffix
        devel:libxkbcommon$secondaryArchSuffix
        devel:libz$secondaryArchSuffix
	devel:libjpeg$secondaryArchSuffix
	devel:libtiff$secondaryArchSuffix
	devel:libpng16$secondaryArchSuffix
        "

BUILD_PREREQUIRES="
        cmd:gcc$secondaryArchSuffix
        cmd:glib_compile_schemas
        cmd:ld$secondaryArchSuffix
        cmd:meson
        cmd:ninja
        cmd:patch
        cmd:pkg_config$secondaryArchSuffix
        cmd:wayland_scanner
        cmd:which
        cmd:update_mime_database$secondaryArchSuffix
        cmd:sassc
        "

BUILD()
{
        CFLAGS="-D_BSD_SOURCE" \
        LDFLAGS="-lbsd -lgnu -lnetwork" \
        meson Build \
                --buildtype=release \
                --prefix="$prefix" \
                --libdir="$libDir" \
                --includedir="$includeDir" \
                --bindir="$commandBinDir" \
                --libexecdir="$commandBinDir" \
                --datadir="$dataDir" \
                --localedir="$dataDir/locale" \
                --sysconfdir="$settingsDir" \
                -Dmedia-gstreamer=disabled \
                -Dx11-backend=false \
                -Dwayland-backend=true \
                -Dbroadway-backend=false \
                -Dintrospection=enabled \
                -Dvulkan=disabled

        ninja -C Build
}

INSTALL()
{
        ninja install -C Build

        rm -rf $dataDir/glib-2.0/schemas/gschemas.compiled
        rm -rf $dataDir/icons/hicolor/icon-theme.cache

        mkdir -p $postInstallDir
        cp -f $portDir/additional-files/compile-schemas.sh $postInstallDir
        chmod -v a+rx $postInstallDir/compile-schemas.sh

        fixPkgconfig
        prepareInstalledDevelLibs \
                libgtk-4 \

        packageEntries devel \
                $developDir
}
